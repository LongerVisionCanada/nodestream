<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>nodestream.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Nodestream.html">Nodestream</a><ul class='methods'><li data-type='method'><a href="Nodestream.html#download">download</a></li><li data-type='method'><a href="Nodestream.html#pipeline">pipeline</a></li><li data-type='method'><a href="Nodestream.html#registerTransform">registerTransform</a></li><li data-type='method'><a href="Nodestream.html#remove">remove</a></li><li data-type='method'><a href="Nodestream.html#upload">upload</a></li></ul></li><li><a href="Pipeline.html">Pipeline</a><ul class='methods'><li data-type='method'><a href="Pipeline.html#download">download</a></li><li data-type='method'><a href="Pipeline.html#remove">remove</a></li><li data-type='method'><a href="Pipeline.html#upload">upload</a></li><li data-type='method'><a href="Pipeline.html#use">use</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">nodestream.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Nodestream
 *
 * @author      Robert Rossmann &lt;robert.rossmann@me.com>
 * @copyright   2016 Robert Rossmann
 * @license     BSD-3-Clause
 */

'use strict'

const Pipeline = require('./pipeline')
const isInstalled = require('./util/is-installed')
const scope = Symbol('nodestream internal')

/**
 * The Nodestream class. Responsible for streaming your bytes up and down, relentlessly.
 */
class Nodestream {

  /**
   * Create a new instance
   *
   * Generally, you only need to create new instance for a specific storage destination.
   *
   * @param     {Object}        options             Options to use for this destination
   * @param     {Class|String}  options.adapter     Storage adapter to use for this destination.
   *                                                If string is given, `nodestream-{adapter}` will
   *                                                be `require`d.
   * @param     {Object}        options.config      Storage adapter-specific configuration
   * @return    {Nodestream}
   */
  constructor(options) {
    // Normalise...
    options = options || {}
    options = {
      config: options.config || {},
      adapter: options.adapter
    }

    // Allow specifying adapters as strings and take care of requiring them
    if (typeof options.adapter === 'string') {
      const pkg = `nodestream-${options.adapter}`

      if (!isInstalled(pkg)) {
        throw new Error(`Cannot find adapter package ${pkg} - did you \`npm install\` it?`)
      }

      // eslint-disable-next-line global-require
      options.adapter = require(pkg)
    }

    // If the adapter has been provided explicitly, make sure it's a constructor function/class
    if (typeof options.adapter !== 'function') {
      throw new TypeError('You must provide a valid Nodestream adapter')
    }

    if (typeof options.adapter.identity !== 'string') {
      throw new ReferenceError(`Adapter ${options.adapter.name} does not declare its identity`)
    }

    this[scope] = {
      options,
      // Instantiate the adapter
      // eslint-disable-next-line new-cap
      adapter: new options.adapter(options.config),
      transforms: new Map()
    }
  }

  /**
   * Create a new pipeline from this Nodestream instance
   *
   * @return    {Pipeline}
   */
  pipeline() {
    return new Pipeline({
      adapter: this[scope].adapter,
      transforms: this[scope].transforms
    })
  }

  /**
   * Upload a file to the remote storage
   *
   * This is a convenience method to be used in situations where you do not need a pipeline and just
   * want a file to be uploaded to the remote storage.
   *
   * @param     {stream.Readable}   file                A readable stream representing the file to
   *                                                    be uploaded
   * @param     {Object?}           options             Options for the upload
   * @param     {String?}           options.directory   Directory to which the file should be
   *                                                    uploaded
   * @param     {String?}           options.name        Filename to upload the file to. If you do
   *                                                    not provide a name, a random UUIDv4 string
   *                                                    will be generated for you.
   * @return    {Promise}
   */
  upload(file, options) {
    return this.pipeline().upload(file, options)
  }

  /**
   * Download a file from the remote storage
   *
   * This is a convenience method to be used in situations where you do not need a pipeline and just
   * want a file to be downloaded from the remote storage.
   *
   * @param     {String}            location      The location of the file on the remote storage to
   *                                              download
   * @param     {stream.Writable}  destination    The destination stream into which to send the data
   * @param     {Object?}          options        Options for the download
   * @return    {Promise}
   */
  download(location, destination, options) {
    return this.pipeline().download(location, destination, options)
  }

  /**
   * Remove a file from the remote storage
   *
   * This is a convenience method to be used in situations where you do not need a pipeline and just
   * want a file to be removed from the remote storage.
   *
   * @param     {String}      location      The location of the file on the remote storage to remove
   * @return    {Promise}
   */
  remove(location) {
    return this.pipeline().remove(location)
  }

  /**
   * Register a transform
   *
   * You must use this method to register a transform before you can [`.use()`]{@link Pipeline#use}
   * it in a pipeline.
   *
   * @param     {Class|String}  transformer   A class/constructor function to be used for data
   *                                          transformations. A new instance of this class will be
   *                                          created for each file being uploaded/downloaded. If a
   *                                          string is given, `nodestream-transform-{transformer}`
   *                                          will be `require`d.
   * @return    {this}
   */
  registerTransform(transformer) {
    // Allow specifying transformers as strings and take care of requiring them
    if (typeof transformer === 'string') {
      const pkg = `nodestream-transform-${transformer}`

      if (!isInstalled(pkg)) {
        throw new Error(`Cannot find transform package ${pkg} - did you \`npm install\` it?`)
      }

      // eslint-disable-next-line global-require
      transformer = require(pkg)
    }

    if (typeof transformer !== 'function') {
      throw new TypeError('Transformer must be a class or constructor function')
    }

    if (typeof transformer.identity !== 'string') {
      throw new ReferenceError(`Transformer ${transformer.name} does not declare its identity`)
    }

    this[scope].transforms.set(transformer.identity, transformer)

    return this
  }
}

module.exports = Nodestream
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Aug 22 2016 00:44:54 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
